name: ML Training Pipeline
on: [push, pull_request]

jobs:
  train-and-report:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: Install Dependencies
        run: pip install pandas scikit-learn joblib

      - name: Execute Training Script
        run: python train.py

      - name: Write Job Summary
        run: |
          echo "## Experiment Metrics" >> $GITHUB_STEP_SUMMARY
          echo "**Name:** Shashank Upadhyay" >> $GITHUB_STEP_SUMMARY
          echo "**Roll Number:** 2022BCS0088" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          cat output/results.json | jq -r '"- MSE: \(.mse)\n- R2: \(.r2)"' >> $GITHUB_STEP_SUMMARY

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: model-and-results
          path: output/
